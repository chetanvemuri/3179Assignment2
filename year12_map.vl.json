{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 900,
  "height": 560,
  "projection": {"type": "mercator"},

  "data": { "url": "STE_2021_AUST_GDA2020.json" },

  "transform": [
  { "calculate": "datum.properties && datum.properties.STE_NAME21 ? datum.properties.STE_NAME21 : null", "as": "region_name" },
  { "filter": "datum.region_name != null" },
  {
    "lookup": "region_name",
    "from": {
      "data": { "url": "year12_certification_by_state.json", "format": {"type":"json"} },
      "key": "STE_NAME21",
      "fields": ["Year12_rate"]
    }
  },
  { "calculate": "toNumber(datum.Year12_rate)", "as": "Year12_rate" },
  { "filter": "isValid(datum.Year12_rate)" }
],

  "mark": {"type": "geoshape"},

  "encoding": {
    "color": {
      "field": "Year12_rate",
      "type": "quantitative",
      "title": "Year 12 Certification (%)",
      "scale": {"scheme": "blues", "clamp": true}
    },
    "tooltip": [
      {"field": "region_name", "title": "State/Territory"},
      {"field": "Year12_rate", "title": "Year 12 (%)", "format": ".1f"}
    ]
  },

  "config": { "view": { "stroke": null } }
}